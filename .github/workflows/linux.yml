name: Linux

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
    - uses: actions/checkout@v4
    - name: install host sbcl
      run: |
        sudo apt-get -qq update | true
        sudo apt-get -qq install libzstd-dev
        cd /tmp/
        wget -q https://github.com/sbcl/sbcl/releases/download/sbcl-1.4.14/sbcl-2.4.8-x86-64-linux-binary.tar.bz2
        tar xf sbcl-2.4.8-x86-64-linux-binary.tar.bz2
        cd sbcl-2.4.8-x86-64-linux/
        sudo ./install.sh
    - name: build
      run: ./make.sh --xc-host='sbcl --dynamic-space-size 700MB --disable-ldb --disable-debugger'
    - name: test
      run: cd tests; ./run-tests.sh
